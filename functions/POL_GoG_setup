#!/bin/bash

# 1 : Game to download
# 2.. : Md5sum(s) of piece(s)

if [ "$POL_SELECTED_FILE" ]; then
	POL_Debug_Message "Using selected file"
	POL_GoG_location="$POL_SELECTED_FILE"
else
	INSTALL_METHOD_BACK="$INSTALL_METHOD"
	pushd .

	if [ -n "$POL_WGET" ]; then # PlayOnLinux can understand GoG_Download
		POL_Debug_Message "PlayOnLinux can understand GoG_Download"
		POL_SetupWindow_InstallMethod LOCAL,DOWNLOAD
	else
		POL_Debug_Message "PlayOnLinux do not understand GoG_Download"
		INSTALL_METHOD="LOCAL"
	fi

	POL_Debug_Message "Install method $INSTALL_METHOD"

	if [ "$INSTALL_METHOD" = "DOWNLOAD" ]; then
		local GOG_REPO="$(POL_Config_Read GOG_REPO)"
		if [ -z "$GOG_REPO" ]; then
			POL_SetupWindow_textbox "$(eval_gettext 'In what directory do you want to download GOG files?')" "$TITLE" "$POL_USER_ROOT/tmp/"
			GOG_REPO="$APP_ANSWER"
			POL_Config_Write GOG_REPO "$GOG_REPO"
		fi

		[ -d "$GOG_REPO" ] || mkdir -p "$GOG_REPO"
		cd "$GOG_REPO" || cd "$POL_USER_ROOT/tmp/"
		POL_Debug_Message "Will download into $PWD"
		POL_Call POL_GoG_download "$@"
		POL_GoG_location="$PWD/setup_$1.exe"
	fi

	if [ "$INSTALL_METHOD" = "LOCAL" ]; then
		POL_SetupWindow_browse "$(eval_gettext 'Please select the setup file to run.')" "$TITLE" ""
		POL_GoG_location="$APP_ANSWER"
	fi
	INSTALL_METHOD="$INSTALL_METHOD_BACK"
	popd
fi
